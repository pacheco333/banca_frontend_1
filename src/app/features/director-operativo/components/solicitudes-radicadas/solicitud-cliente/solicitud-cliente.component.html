<div class="max-w-6xl p-6 bg-white rounded-lg">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center gap-3 mb-2">
      <button 
        (click)="volver()" 
        class="px-4 py-2 text-gray-700 rounded-md hover:bg-gray-50 transition-colors font-medium cursor-pointer"
        title="Volver"
      >
         <span class="material-icons">arrow_back</span>
      </button>
      <h1 class="text-2xl font-bold text-blue-900 mb-2"  >
        Solicitud cliente <span *ngIf="solicitud">#{{ solicitud.id_solicitud }}</span>
      </h1>
    </div>
  </div>

  <!-- Form Container -->
  <div *ngIf="solicitud && !cargando; else estadoCarga">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-16">

      <!-- Columna Izquierda -->
      <div class="flex flex-col gap-6">

        <div>
          <label class="text-sm font-medium">Nombres</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="solicitud.cliente.primer_nombre + (solicitud.cliente.segundo_nombre ? ' ' + solicitud.cliente.segundo_nombre : '')" />
        </div>

        <div>
          <label class="text-sm font-medium">Correo</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400"
            [value]="solicitud.contacto.correo || 'No registrado'" />
        </div>

        <div>
          <label class="text-sm font-medium">Año de Nacimiento</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="obtenerAnioNacimiento(solicitud.cliente.fecha_nacimiento)" />
        </div>

        <div>
          <label class="text-sm font-medium">Ocupación</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="solicitud.actividad_economica.ocupacion || 'No registrada'" />
        </div>

        <div>
          <label class="text-sm font-medium">Ciudad</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="solicitud.contacto.ciudad || 'No registrada'" />
        </div>

        <div>
          <label class="text-sm font-medium">Comentario Asesor</label>
          <textarea readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 h-28 resize-none text-gray-600"
            [value]="solicitud.comentario_asesor || 'Sin comentario'"></textarea>
        </div>

      </div>

      <!-- Columna Derecha -->
      <div class="flex flex-col gap-6">

        <div>
          <label class="text-sm font-medium">Apellidos</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="solicitud.cliente.primer_apellido + (solicitud.cliente.segundo_apellido ? ' ' + solicitud.cliente.segundo_apellido : '')" />
        </div>

        <div>
          <label class="text-sm font-medium">Teléfono</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="solicitud.contacto.telefono || 'No registrado'" />
        </div>

        <div>
          <label class="text-sm font-medium">Nacionalidad</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400"
            [value]="solicitud.cliente.nacionalidad || 'No registrada'" />
        </div>

        <div>
          <label class="text-sm font-medium">Dirección</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="solicitud.contacto.direccion || 'No registrada'" />
        </div>

        <div>
          <label class="text-sm font-medium">Producto</label>
          <input readonly class="w-full mt-1 border border-gray-200 rounded-lg p-3 text-gray-400" 
            [value]="solicitud.tipo_cuenta" />
        </div>

        <div class="flex flex-col gap-2 mt-2">
          <label class="text-sm font-medium">Archivo adjuntado</label>
            <!-- Mostrar botón de descarga solo si hay archivo -->
            <ng-container *ngIf="tieneArchivo(); else noArchivo">
              <button (click)="descargarArchivo()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium w-fit cursor-pointer hover:bg-blue-700" [disabled]="procesando">
                {{ procesando ? 'Descargando...' : 'Descargar archivo' }}
              </button>
            </ng-container>
            <ng-template #noArchivo>
              <button class="bg-gray-200 text-gray-600 px-4 py-2 rounded-lg font-medium w-fit cursor-not-allowed" disabled>
                Archivo no disponible
              </button>
            </ng-template>
        </div>

      </div>

    </div>

    <!-- Botones Finales -->
    <div class="flex justify-center md:justify-end mt-10 gap-4" *ngIf="solicitud.estado === 'Pendiente'">
      <button (click)="abrirModalRechazo()" 
        class="bg-red-100 text-red-600 px-6 py-3 rounded-lg font-medium hover:bg-red-200 cursor-pointer" 
        [disabled]="procesando">
        Rechazar Solicitud
      </button>
      <button (click)="abrirModalAprobacion()" 
        class="bg-green-100 text-green-700 px-6 py-3 rounded-lg font-medium hover:bg-green-200 cursor-pointer" 
        [disabled]="procesando">
        Aprobar Solicitud
      </button>
    </div>

    <!-- Estado de la solicitud si no es pendiente -->
    <div class="mt-10 p-4 rounded-lg text-center" *ngIf="solicitud.estado !== 'Pendiente'"
      [ngClass]="{
        'bg-green-100 text-green-800': solicitud.estado === 'Aprobada',
        'bg-red-100 text-red-800': solicitud.estado === 'Rechazada',
        'bg-blue-100 text-blue-800': solicitud.estado === 'Devuelta'
      }">
      <p class="font-semibold">Estado: {{ solicitud.estado }}</p>
      <p *ngIf="solicitud.comentario_director" class="mt-2 text-sm">
        Comentario: {{ solicitud.comentario_director }}
      </p>
    </div>

  </div>

  <!-- MODAL RECHAZO -->
  <div *ngIf="mostrarModalRechazo"
    class="fixed inset-0 z-50 flex items-center justify-center bg-blue bg-opacity-60 backdrop-blur-sm">
    <div class="bg-white w-[90%] max-w-lg p-6 rounded-xl shadow-xl">
      <h2 class="text-xl font-semibold mb-4">Motivo rechazo</h2>
      <textarea [(ngModel)]="motivoRechazo"
        class="w-full border border-gray-300 rounded-lg p-3 h-32 resize-none"
        placeholder="Escribe el motivo del rechazo aquí..."></textarea>

      <div class="flex justify-end gap-4 mt-6">
        <button (click)="cerrarModalRechazo()" [disabled]="procesando"
          class="px-4 py-2 bg-gray-200 rounded-lg font-medium hover:bg-gray-300">
          Cancelar
        </button>
        <button (click)="confirmarRechazo()" [disabled]="procesando"
          class="px-4 py-2 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600">
          {{ procesando ? 'Procesando...' : 'Rechazar solicitud' }}
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL APROBACIÓN -->
  <div *ngIf="mostrarModalAprobacion"
    class="fixed inset-0 z-50 flex items-center justify-center bg-blue bg-opacity-60 backdrop-blur-sm">
    <div class="bg-white w-[90%] max-w-lg p-6 rounded-xl shadow-xl">
      <h2 class="text-xl font-semibold mb-4">Confirmar aprobación</h2>
      <p class="text-gray-700 mb-6">¿Deseas aprobar esta solicitud?</p>

      <div class="flex justify-end gap-4">
        <button (click)="cerrarModalAprobacion()" [disabled]="procesando"
          class="px-4 py-2 bg-gray-200 rounded-lg font-medium hover:bg-gray-300">
          Cancelar
        </button>
        <button (click)="confirmarAprobacion()" [disabled]="procesando"
          class="px-4 py-2 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600">
          {{ procesando ? 'Procesando...' : 'Aprobar solicitud' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Estado de carga / error -->
  <ng-template #estadoCarga>
    <div class="bg-white mt-6 p-10 rounded-xl shadow-sm text-center" *ngIf="cargando">
      <p class="text-gray-600">Cargando solicitud...</p>
    </div>
    <div class="bg-white mt-6 p-10 rounded-xl shadow-sm text-center" *ngIf="!cargando && error">
      <p class="text-red-600">{{ error }}</p>
      <button class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" (click)="volver()">
        Volver
      </button>
    </div>
  </ng-template>

</div>